# Server Configuration
quarkus:
  http:
    root-path: /api/v1
    port: 9905
  java:
    locale:
      timezone: "Asia/Colombo"


  datasource:
    db-kind: oracle
    username: aaa
    password: Aaa!89nky78D
    reactive:
      url: oracle:thin:@localhost:1522/ORCL
      max-size: 20
      idle-timeout: PT10M

  vertx:
    event-loops-pool-size: 32
    warning-exception-time: 10s
    max-event-loop-execute-time: 5s
    max-worker-execute-time: 60s
    prefer-native-transport: true
    caching: true

  thread-pool:
    core-threads: 100
    max-threads: 400
    queue-size: 2000
    growth-resistance: 0
    shutdown-timeout: 30s

  #  datasource:
  #    db-kind: oracle
  #    username: system
  #    password: admin
  #    reactive:
  #      url: oracle:thin:@localhost:1521/freepdb1
  #      max-size: 20
  #      idle-timeout: PT10M
# Idle Session Terminator Configuration
# Sessions older than timeout-minutes will be automatically terminated
# Optimized for 10M+ users using Redis Sorted Set index
idle-session:
  enabled: true
  timeout-minutes: 2       # 1 hour default - sessions older than this will be terminated
  scheduler-interval: 5m    # Run every 5 minutes
  batch-size: 1000          # Process 1000 sessions per batch (increased for scale)
  # max-batches-per-run: 100  # Optional: limit total batches per scheduler run

log:
  file:
   enable: true
   path: D:\
   level: INFO
   format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"
  console:
    format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"
    color: true
  level: INFO
  category:
    "org.apache.kafka":
      level: WARN
    "io.smallrye.reactive.messaging.kafka":
      level: DEBUG
    "io.quarkus.config":
      level: DEBUG
    "io.smallrye.config":
      level: DEBUG

  redis:
    hosts: http://redis.redis.svc.cluster.local:6379
    timeout: 10s
    max-pool-size: 50          # Increased from 20 for 10M user scale
    max-pool-waiting: 100      # Increased for high throughput

# Kafka Configuration
kafka:
  bootstrap.servers: confluent-ctrl-0-svc.rkafkacone.svc.cluster.local:9092



mp:
  messaging:
    outgoing:
      db-write-events:
        connector: smallrye-kafka
        topic: DC-DR
        value.serializer: io.quarkus.kafka.client.serialization.ObjectMapperSerializer
        key.serializer: org.apache.kafka.common.serialization.StringSerializer
        acks: all
        retries: 3
        max.in.flight.requests.per.connection: 5
        compression.type: snappy
        batch.size: 16384
        linger.ms: 10

      accounting-resp-events:
        connector: smallrye-kafka
        topic: accounting-response
        value.serializer: io.quarkus.kafka.client.serialization.ObjectMapperSerializer
        key.serializer: org.apache.kafka.common.serialization.StringSerializer
        acks: all
        retries: 3
        max.in.flight.requests.per.connection: 5
        compression.type: snappy
        batch.size: 16384
        linger.ms: 10

      accounting-cdr-events:
        connector: smallrye-kafka
        topic: cdr-event
        value.serializer: io.quarkus.kafka.client.serialization.ObjectMapperSerializer
        key.serializer: org.apache.kafka.common.serialization.StringSerializer
        acks: all
        retries: 3
        max.in.flight.requests.per.connection: 5
        compression.type: snappy
        batch.size: 16384
        linger.ms: 10

    incoming:
      accounting-events:
        connector: smallrye-kafka
        topic: accounting
        group.id: accounting-consumer-group
        value.deserializer: io.quarkus.kafka.client.serialization.ObjectMapperDeserializer
        key.deserializer: org.apache.kafka.common.serialization.StringDeserializer
        auto.offset.reset: earliest
        enable.auto.commit: true
        max.poll.records: 100
        max.poll.interval.ms: 300000
        session.timeout.ms: 30000
        failure-strategy: ignore


